pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
-- init e update
function _init()
  t = 0
  p_ani = {16,17}
  
  dirx={-1,1,0,0}
  diry={0,0,-1,1}
  
  _upd=update_game
  _drw=draw_game
  startgame()
end
 
function _update()
  t += 1
  _upd()
end
 
function _draw()
 _drw()
end
 
function startgame()
 p_t = 0
 p_x = 8
 p_y = 13
 p_ox = 0
 p_oy = 0
 p_sox = 0
 p_soy = 0
 p_flip = false
 
 p_mov = nil
end
-->8
-- game
function update_game()
  for i=0,3 do
    if btnp(i) then
      move_player(dirx[i+1], diry[i+1])
      return
    end
  end
end

function update_pturn()
  p_t = min(p_t+0.125, 1)
 
  p_mov()
 
  if p_t == 1 then
   _upd = update_game
  end
end

function mov_walk()
  p_ox = p_sox * (1-p_t)
  p_oy = p_soy * (1-p_t)
end

function mov_bump()
  local mov_time = p_t
  if p_t > 0.5 then
    mov_time = 1 - p_t
  end
  p_ox = p_sox * mov_time
  p_oy = p_soy * mov_time
end
 
function draw_game()
  cls(0)
  map()
  draw_spr(get_frame(p_ani), p_x * 8 + p_ox, p_y * 8 + p_oy, p_flip)
end
-->8
-- auxiliares
function get_frame(ani)
  return ani[flr(t/8) % #ani+1]
end

function draw_spr(_spr,_x,_y, _flip)
  spr(_spr, _x, _y, 1, 1, _flip)
end

-->8
-- gameplay

function move_player(dx, dy)
  local dest_x, dest_y = p_x+dx, p_y+dy
	 local tile = mget(dest_x, dest_y)
	 
  if dx < 0 then
    p_flip = true
  elseif dx > 0 then
    p_flip = false
  end
  
	 if fget(tile, 0) then
	   -- mesma camada do jogador
	   p_sox,p_soy = dx*4,dy*4
		  p_ox,p_oy = 0,0
		  p_t = 0
		  _upd  = update_pturn
		  p_mov = mov_bump
	 else
		  p_x += dx
		  p_y += dy
		  
		  p_sox,p_soy = -dx*8,-dy*8
		  p_ox,p_oy = p_sox,p_soy
		  p_t = 0
		  _upd  = update_pturn
		  p_mov = mov_walk
	 end
end
__gfx__
00000000111111115555555500555500005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111115555555505666650056666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111111115555555556666660566666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111115555555556dddd6056dddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111115555555556666660566666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111d11115555555556666660566666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111115555555556666660566663600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111115555555556666660563633600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02211112002222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22171712022111120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22171712221717120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02111112221717120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222220021111120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02221220002222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02211220022212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01667711016677110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16677771166777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16707071167070710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16707071167070710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16777771167777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16716161161616610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01101010010101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101020202020101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101020101020202010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101020101010102020101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101020101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010201010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010201010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
